(function(d){var f,l,g,p=1,h,m=this,n,j=m.postMessage,i,e;if(!j)var k=[],o,q=function(){o=setInterval(function(){if(0<k.length)i.location=e.replace(/#.*$/,"")+"#"+ +new Date+p++ +"&"+k.shift()},500)};d.postMessage=function(c,a,b){if(e=a)if(c="string"===typeof c?c:d.param(c),i=b||parent,j)i.postMessage(c,e.replace(/([^:]+:\/\/[^\/]+).*/,"$1"));else if(e){c=c.match(/.{1,1000}/g);a=0;for(b="";b=c[a++];)k.push(b+"&;;pm_part="+a+","+c.length);"undefined"===typeof o&&q(i,e)}};d.receiveMessage=n=function(c,a,b){b=a&&d.isWindow(a)?a:b&&d.isWindow(b)?b:m;if(j)if(c&&(h&&n(),h=function(b){if("string"===typeof a&&b.origin!==a||d.isFunction(a)&&!1===a(b.origin))return!1;c(b)}),b.addEventListener)b[c?"addEventListener":"removeEventListener"]("message",h,!1);else b[c?"attachEvent":"detachEvent"]("onmessage",h);else f&&clearInterval(f),f=null,c&&(delay="number"===typeof a?a:"number"===typeof delay?delay:100,f=setInterval(function(){var a=b.document.location.hash,d=/^#?\d+&/;a!==l&&d.test(a)&&(l=a,a=a.match(/(.*)&;;pm_part=(\d+),(\d+)/),g+=a[1].replace(d,""),a[2]===a[3]&&(c({data:g}),g=""))},100))}})(jQuery);
