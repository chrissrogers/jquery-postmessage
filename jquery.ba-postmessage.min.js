(function(f){var g,j,h,o=1,i,k=this,l,m=k.postMessage&&!f.browser.opera;f.postMessage=function(a,b,e){if(b)if(a="string"===typeof a?a:f.param(a),e=e||parent,m)e.postMessage(a,b.replace(/([^:]+:\/\/[^\/]+).*/,"$1"));else if(b){var d=0;jqpmSendHashMessage=function(a){e.location=b.replace(/#.*$/,"")+"#"+ +new Date+o++ +"&"+a};for(var a=a.match(/.{1,1000}/g),c=0,n="";n=a[c++];)setTimeout('jqpmSendHashMessage("'+n+"&;;pm_part="+c+","+a.length+'")',d),d+=500}};f.receiveMessage=l=function(a,b,e,d){d=b&&f.isWindow(b)?b:e&&f.isWindow(e)?e:d&&f.isWindow(d)?d:k;if(m)if(a&&(i&&l(),i=function(c){if("string"===typeof b&&c.origin!==b||f.isFunction(b)&&!1===b(c.origin))return!1;a(c)}),d.addEventListener)d[a?"addEventListener":"removeEventListener"]("message",i,!1);else d[a?"attachEvent":"detachEvent"]("onmessage",i);else g&&clearInterval(g),g=null,a&&(g=setInterval(function(){var c=d.document.location.hash,b=/^#?\d+&/;c!==j&&b.test(c)&&(j=c,c=c.match(/(.*)&;;pm_part=(\d+),(\d+)/),h+=c[1].replace(b,""),c[2]===c[3]&&(a({data:h}),h=""))},"number"===typeof b?b:"number"===typeof e?e:100))}})(jQuery);
